<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login Redirect</title>
</head>
<body>
  <h2>Processing login...</h2>
  <script type="module">
    import createAuth0Client from "https://cdn.jsdelivr.net/npm/@auth0/auth0-spa-js@2.1.3/dist/auth0-spa-js.production.js";

    async function init() {
      const auth0 = await createAuth0Client({
        domain:  process.env.AUTH0_DOMAIN,
        client_id: process.env.AUTH0_CLIENT_ID,
        redirect_uri: window.location.origin + "/login"
      });

      // Handle the redirect from Auth0
      if (window.location.search.includes("code=") && window.location.search.includes("state=")) {
        await auth0.handleRedirectCallback();
        const user = await auth0.getUser();
        console.log("Logged in user:", user);

        // Store user info or token if needed
        const token = await auth0.getTokenSilently();
        localStorage.setItem("auth_token", token);

        // Redirect to home or dashboard
        window.location.replace("/");
      }
    }

    init();
  </script>
</body>
</html>
